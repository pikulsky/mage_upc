# История измений
 
## версия 1.2.0.0
* замена пробелов на табы
* исправлено: если неудачная оплата, корзина покупателя восстанавливается;
* исправленo: статус заказа устанавливается в статус по умолчанию для данного состояния заказа (т.к. в магазине могут быть другие статусы для состояний заказа);
* поддержка нескольких валют в магазине: по умолчанию валюта UPC - это "UAH", валюта заказа проверяется, при необходимости сумма заказа конвертируется в сумму в валюте UPC
* исправлено: регистр букв в названиях классов, т.к. модуль не работал в Линуксе, регистр названия файла Upc.php

# Описание модуля

Состояние заказа:
* при начале оплаты заказ получает состояние 'pending_payment';
* при успешной оплате - заказ получает состояние 'processing';
* при неуспешной оплате - заказ получает состояние 'canceled'.

В истории заказа:
* "The customer was redirected to UPC.","Покупатель перенаправлен на сайт UPC."
* "Payment was successful. Approval code: %s","Успешная оплата. Код авторизации: %s"
* "Payment failed: %s. Approval code: %s","Ошибка при оплате: %s. Код авторизации: %s"

В UPC описание заказа задано так:
* англ. вариант: 'Payment for order #%s'
* русский вариант: "Оплата заказа #%s"

Сообщения, настройки - на английском, есть перевод на русский. Замечание: сообщения об ошибке от UPC - только на русском. При необходимости, н-р, украинского интерфейса - необходимо будет дополнительно сделать возможность перевода этих сообщений.

# Файлы
* \app\etc\modules\Bavers_UpcPayment.xml
* \app\locale\ru_RU\Bavers_UpcPayment.csv
* \app\design\frontend\base\default\template\upcpayment\
  * message.phtml - текст при выборе метода оплаты и текст в окне с выбранным методом оплаты
  * redirect.phtml - форма редиректа
* \app\code\community\Bavers\UpcPayment\

После копирования файлов необходимо сбросить Magento кеш: Меню System > Cache Management, сбросить оба кеша: нажать кнопку 'Flush Magento Cache' и 'Flush Cache Storage'. Это необходимо для активации модуля в Magento.

# Валюта
В модуле установлена валюта, которая в договоре с UPC - гривна (UAH) Если в магазине несколько валют, тогда необходимо:
1) добавить валюту, которая в договоре с UPC (UAH);
2) установить курс(ы) других валют по отношению к валюте, которая в договоре с UPC (UAH).

# Логирование
* используется стандартное логирование Magento (Mage::log())

# Настройки

## Настройка аккаунта в UPC

Заходите в мерчант-аккаунт UPC, выбираете меню "Терминалы", выбираете свой терминал. Для терминала выставляете параметры:
* "Число спроб вводу карти" = 1 (один)
* "Адреса URL для сповіщення торговця ( NOTIFY_URL )" - взять из настроек модуля в админке магазина из поля "Адрес обратного вызова"
Сохранить.

## Настройки, связанные с UPC
* Тестовый режим/рабочий режим
* Merchant ID
* Terminal ID
* Private Key
* Public Key
* Язык интерфейса в UPC (выбор из: русский, украинский, английский)
* Notify URL

## Настройки, связанные с Магенто
* Включен/выключен
* Название метода оплаты в списке методов оплаты
* Номер по порядку среди других методов оплаты

## Настройки в коде
* Сохранение файлов ключей: \var\uploads (задается в \app\code\community\Bavers\UpcPayment\etc\system.xml)

# Что можно улучшить
* Статусы при начале и успешном завершении заказа можно вынести в настройки
* Сделать возможной локализацию текстов ошибок от UPC
* Язык интерфейса в UPC выставлять согласно языку покупателя, если язык покупателя есть среди доступных языков интерфейса в UPC, добавить больше языков UPC
* Добавить поддержку альтернативной валюты
